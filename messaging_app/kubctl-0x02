#!/bin/bash
# kubctl-0x02
# Deploy blue and green, check logs of green

set -e

echo "ğŸš€ Deploying BLUE version..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "ğŸš€ Deploying GREEN version..."
kubectl apply -f messaging_app/green_deployment.yaml

echo "â³ Waiting for pods to start..."
kubectl rollout status deployment/django-messaging-blue
kubectl rollout status deployment/django-messaging-green

echo "ğŸ“¦ Current pods:"
kubectl get pods -l app=django-messaging

GREEN_POD=$(kubectl get pods -l app=django-messaging,version=green -o jsonpath='{.items[0].metadata.name}')

echo "ğŸ” Checking logs for GREEN version pod: $GREEN_POD"
kubectl logs "$GREEN_POD"

echo "âœ… To switch traffic to GREEN version:"
echo "kubectl patch service django-messaging-service -p '{\"spec\":{\"selector\":{\"app\":\"django-messaging\",\"version\":\"green\"}}}'"
